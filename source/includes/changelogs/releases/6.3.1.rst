.. _6.3.1-changelog:

6.3.1 Changelog
---------------

Sharding
~~~~~~~~

- :issue:`SERVER-72146` Make chunk migrations metrics more accessible
  from Atlas
- :issue:`SERVER-73229` Logical sessions cache refresh ignores write
  errors from updating session document, leading to cursors being killed
  early
- :issue:`SERVER-73877` Wait for shard to have a primary before doing a
  migration in prepare_transaction_then_migrate.js
- :issue:`SERVER-74380` Router role retry loop should allow namespaces
  different from the one it was created for
- :issue:`SERVER-75481` Consider ideal data size when balancing
- :issue:`SERVER-76004` Remove incorrect sharding tassert in
  getOwnershipFilter function
- :issue:`SERVER-76178` Fix moveRange authorization requirements
- :issue:`SERVER-76394` Allow the setAllowMigrations refresh to be sent
  to all shards in a backportable way

Query
~~~~~

:issue:`SERVER-72224` Clustered collections with non-"simple" default
collation miss documents when querying on _id using "simple" collation

Write Operations
~~~~~~~~~~~~~~~~

:issue:`SERVER-75517` illegal format of _id possible via upsert

Internals
~~~~~~~~~

- :issue:`SERVER-66927` Remove reference to silentFail from mongo repo
- :issue:`SERVER-67105` $in queries do not use clustered index
- :issue:`SERVER-68670` Cache imbalanced collections for balancing
- :issue:`SERVER-69952` Filtering on dates outside of the 32 bit epoch
  range returns wrong results
- :issue:`SERVER-71009` Make sure the select chunks operation doesn't
  take too long
- :issue:`SERVER-71636` Explain executionStats does not work for $lookup
  on sharded collection
- :issue:`SERVER-72520` Decommission Microbenchmark performance tests
  that are running on CBI instances
- :issue:`SERVER-72686` Add support for $collStats agg stage on
  timeseries collection
- :issue:`SERVER-73108` Handle command request/reply
  serialization/deserialization
- :issue:`SERVER-73163` shard_split_shutdown_while_blocking_reads should
  handle exception in readThread
- :issue:`SERVER-73383` Defragmentation may start over right after
  finishing
- :issue:`SERVER-73482` $natural hint overrides sort on clustered
  collections
- :issue:`SERVER-73734` Support evergreen nightly project in
  burn_in_tests.py
- :issue:`SERVER-73830` Retrieving alternate buckets for inserts not
  handling buckets pending direct writes
- :issue:`SERVER-73855` Update recipientForgetMigration error handling
  logic to properly handle CallbackCanceled
- :issue:`SERVER-73887` Allow untimestamped writes for the entirety of
  initial sync retry
- :issue:`SERVER-73936` Clean up timeseries_direct_update.js and add
  logs
- :issue:`SERVER-73973` [test-only bug] Skip orphans checking in
  server_status_with_time_out_cursors.js
- :issue:`SERVER-74122` add readtest.c to the asan denylist
- :issue:`SERVER-74131` Multiplanning together with subplanning causes
  server crash in mapReduce queries
- :issue:`SERVER-74303` Add a sizeStorer call to the onRollback handler
  for dataSize and numRecords changes
- :issue:`SERVER-74368` Reduce log verbosity for virtual collection
  queries
- :issue:`SERVER-74469` Make the ShardingCatalogManager set the
  'validAfter' field of a chunk when it is migrated
- :issue:`SERVER-74684` Size storer not being flushed periodically
- :issue:`SERVER-74694` cleanupOrphaned command may fail with "Range
  deleter service not up error" on step up
- :issue:`SERVER-74720` The default 'shardingStatistics' serverStatus
  section takes locks
- :issue:`SERVER-74871` Clean up Jepsen tests
- :issue:`SERVER-74895` Expect command errors in validation when
  querying $collStats, and improve the error message
- :issue:`SERVER-74897` Change IDL defined commands to call
  NamespaceStringUtil
- :issue:`SERVER-75066` Check for parent directory before writing to
  SCons cache
- :issue:`SERVER-75082` Make balancer migrations throttling configurable
- :issue:`SERVER-75090` ftdc_connection_reuse.js -- test fails when
  poolConnUsageTimeMillis does not increase
- :issue:`SERVER-75147` Remove FLE2 tests from replset continuous
  stepdowns suite
- :issue:`SERVER-75230` Package test fails on Ubuntu 16.04
- :issue:`SERVER-75239` [v6.3] Remove accidentally added tests from
  backports_required_for_multiversion_tests.yml
- :issue:`SERVER-75261` "listCollections" command fails with
  BSONObjectTooLarge error
- :issue:`SERVER-75269` Re-introduce Classic Engine build variant on the
  6.3 branch
- :issue:`SERVER-75277` TTL deleter attributes resource metrics across
  multiple databases
- :issue:`SERVER-75299` Reduce severity of BalancerStatsRegistry logs
- :issue:`SERVER-75366` Additional debug log lines in range deleter
  service
- :issue:`SERVER-75431` Get rid or fix best effort check for primary db
  on rename path in sharded clusters
- :issue:`SERVER-75479` Use system python on macos for ssl tests
- :issue:`SERVER-75501` Don't run Sys-perf FCV variants on stable
  branches
- :issue:`SERVER-75519` Split task
  sharded_collections_jscore_passthrough due to timeout
- :issue:`SERVER-75561` Report and log more detailed information when
  validate encounters multikey inconsistencies
- :issue:`SERVER-75566` Disable powercycle on windws
- :issue:`SERVER-75601` Make serverStatus apiversion field more robust
- :issue:`SERVER-75626` Special handling for macosx venv
- :issue:`SERVER-75639` Remove dedicated executor for
  moveChunk/moveRange commands
- :issue:`SERVER-75745` Only log record and index metadata associated
  with missing or extra index keys
- :issue:`SERVER-75795` Update aws_e2e_ec2.js for evergreen changes to
  AWS test identity
- :issue:`SERVER-75990` Tenant Migrations are not resilient to recipient
  failover
- :issue:`SERVER-76009` Fix stepdown behavior in
  read_ticket_exhaustion_with_stepdown test
- :issue:`SERVER-76038` Remove FLE2 tests from
  sharded_retryable_writes_downgrade suite
- :issue:`SERVER-76102` handleRIDRangeScan() sets hasCompatibleCollation
  wrong in recursive cases
- :issue:`SERVER-76172` Fix BalancerChunkSelection unit test on slow
  build variants
- :issue:`SERVER-76274` Move microbenchmarks to their own task distro
- :issue:`SERVER-76321` Buffer overrun while deserializing compound
  group key spilled to disk in SBE hash agg implementation
- :issue:`SERVER-76457` Support storing BuildID to debug symbols mapping
  for sanitizer builds
- :issue:`SERVER-76498` Update push task to run on rhel8.7-small
- :issue:`SERVER-76543` The mongod-dump-sessions gdb pretty printer does
  not work
- :issue:`SERVER-76549` Remove symbolization from macos variants
- :issue:`SERVER-76550` Balancer is unable to drain shards with big
  chunks
- :issue:`SERVER-76580` Allow overriding SerializationContext objs
  constructed in IDL
- :issue:`SERVER-76584` Ensure $tenant field sets the
  nonPrefixedTenantId flag
- :issue:`SERVER-76666` Make buildscripts_test run on v6.3 branch

