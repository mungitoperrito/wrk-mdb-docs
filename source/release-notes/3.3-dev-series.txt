:orphan:

==========================================
Release Notes for Development Series 3.3.x
==========================================

.. default-domain:: mongodb

.. include:: /includes/3.3-dev-series.rst

.. _3.4-rel-notes-aggregation-cluster:

Aggregation
-----------

New Aggregation Array Operators
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :widths: 20 80

   * - Operator
     - Description
     
   * - :expression:`$in`

     - Returns a boolean that indicates if a specified value is in an
       array.


   * - :expression:`$indexOfArray`

     - Searches an array for an occurence of a specified value and
       returns the array index (zero-based) of the first occurence.

   * - :expression:`$range`

     - Returns an array whose elements are a generated sequence of
       numbers.

   * - :expression:`$reverseArray`

     - Returns an output array whose elements are those of the input
       array but in reverse order.

   * - :expression:`$reduce`

     - Takes an array as input and applies an expression to each
       element in the array to return the final result of the
       expression.

   * - :expression:`$zip`

     - Returns an output array where each element is itself an array,
       consisting of elements in the corresponding array index position
       from the input arrays.

New Aggregation String Operators
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :widths: 20 80

   * - Operator
     - Description
     
   * - :expression:`$indexOfBytes`

     - Searches a string for an occurence of a substring and returns
       the UTF-8 byte index (zero-based) of the first occurence.

   * - :expression:`$indexOfCP`

     - Searches a string for an occurence of a substring and returns
       the UTF-8 `code point
       <http://www.unicode.org/glossary/#code_point>`_ index
       (zero-based) of the first occurence.

   * - :expression:`$split`

     - Splits a string by a specified delimiter into string components
       and returns an array of the string components.


   * - :expression:`$strLenBytes`

     - Returns the number of UTF-8 bytes for a string.

   * - :expression:`$strLenCP`

     - Returns the number of UTF-8 `code points
       <http://www.unicode.org/glossary/#code_point>`_ for a string.

   * - :expression:`$substrBytes`

     - Returns the substring of a string. The substring starts with the
       character at the specified UTF-8 byte index (zero-based) in the
       string for the length specified.

   * - :expression:`$substrCP`

     - Returns the substring of a string. The substring starts with the
       character at the specified UTF-8 `code point
       <http://www.unicode.org/glossary/#code_point>`_ index
       (zero-based) in the string for the length specified.

New Aggregation Control Flow Expression
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :widths: 20 80

   * - Operator
     - Description
     
   * - :expression:`$switch`

     - Evaluates, in sequential order, the ``case`` expressions of the
       specified branches to enter the first branch for which the
       ``case`` expression evaluates to ``true``.

New Date Aggregation Operators
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :widths: 20 80

   * - Operator
     - Description
     
   * - :expression:`$isoDayOfWeek`

     - Returns the ISO 8601 weekday number, ranging from ``1`` (for
       Monday) to ``7`` (for Sunday).

   * - :expression:`$isoWeek`

     - Returns the ISO 8601 week number, which can range from ``1`` to
       ``53``. Week numbers start at ``1`` with the week (Monday
       through Sunday) that contains the year's first Thursday.

   * - :expression:`$isoWeekYear`

     - Returns the ISO 8601 year number, where the year starts with the
       Monday of week 1 (ISO 8601) and ends with the Sundays of the
       last week (ISO 8601).

Additional Aggregation Operator
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :widths: 26 74

   * - Operator
     - Description
     
   * - :expression:`$type`

     - Returns a string which specifies the
       :doc:`/reference/bson-types/` of the argument.

