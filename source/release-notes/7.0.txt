.. _release-notes-7.0:

=================================================
Release Notes for MongoDB 7.0 (Release Candidate)
=================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: twocols

Atlas Search Index Management
-----------------------------

Starting in MongoDB 7.0, you can manage :atlas:`{+fts+} indexes
</atlas-search/atlas-search-overview/#fts-indexes>` with database
commands. {+fts+} index database commands are only available for
deployments hosted on :atlas:`MongoDB Atlas </>`.

To manage {+fts+} indexes, use the following commands:

.. include:: /includes/atlas-search-commands/atlas-search-command-table.rst

General Changes
---------------

``currentOp`` Metrics
~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0, the :dbcommand:`currentOp` command and the
:method:`db.currentOp()` method include these new fields:

- :data:`currentOp.admissionPriority`

Large Change Stream Events
~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0, if you have :ref:`change stream
<changeStreams>` events larger than 16 MB, you can use the new
:pipeline:`$changeStreamSplitLargeEvent` stage to split the events into
smaller fragments.

The following new metrics report information about large change stream
events:

- :serverstatus:`metrics.changeStreams`
- :serverstatus:`metrics.changeStreams.largeEventsFailed`
- :serverstatus:`metrics.changeStreams.largeEventsSplit`

Store Application Data on Config Shards
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0, you can configure a config server to store
application data in addition to the usual sharded cluster metadata. The
config server is then known as a *config shard*. For details, see
:ref:`sharded-cluster-config-server-config-shards`.

{+sbe-title+}
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0, the :ref:`{+sbe+} <5.1-rel-notes-sbe>` improves
performance for a wider range of find and aggregation queries.

:ref:`Slow query log messages <log-message-json-examples-slow-op>` now
include a ``queryFramework`` field that indicates which query engine
completed the query:

- ``queryFramework: "classic"`` indicates that the classic engine
  completed the query.

- ``queryFramework: "sbe"`` indicates that the {+sbe+} completed the
  query.

New Parameters
~~~~~~~~~~~~~~

autoMergerIntervalSecs Parameter
````````````````````````````````

MongoDB 7.0 adds the :parameter:`autoMergerIntervalSecs` parameter 
which, when {+auto-merge-upper+} is enabled, specifies the amount of 
time between {+auto-merge-action+} rounds, in seconds. 
``autoMergerIntervalSecs`` can only be set on config servers of sharded
clusters.

autoMergerThrottlingMS Parameter
````````````````````````````````

MongoDB 7.0 adds the :parameter:`autoMergerThrottlingMS` which, when 
{+auto-merge-upper+} is enabled, specifies the minimum amount time 
between merges initiated by the {+auto-merge-upper+} on the same 
collection, in milliseconds. ``autoMergerThrottlingMS`` can only be set
on config servers of sharded clusters.

balancerMigrationsThrottlingMs Parameter
````````````````````````````````````````

MongoDB 7.0 adds the :parameter:`balancerMigrationsThrottlingMs`
parameter which allows you to throttle the balancing rate.

gEnableDetailedConnectionHealthMetricLogLines Parameter
```````````````````````````````````````````````````````

MongoDB 7.0 adds the :parameter:`gEnableDetailedConnectionHealthMetricLogLines`
parameter which lets you specify whether or not a set of :ref:`log messages 
<log-messages-ref>` related to cluster connection health metrics appears in the 
log.

Security
~~~~~~~~

MongoDB 7.0 (and 6.0.6) adds the :setting:`useLegacyProtocol
<security.kmip.useLegacyProtocol>` setting. This setting allows MongoDB
servers to connect to KMIP servers that use KMIP protocol version 1.0 or
1.1.

OpenSSL and FIPS Support
````````````````````````

.. include:: /includes/ssl-and-fips-support.rst

For details, see :ref:`transport-encryption`.

Aggregation
-----------

New operators:

.. list-table::
   :header-rows: 1

   * - Name
     - Description

   * - :group:`$median` 
     - .. include:: /includes/aggregation/fact-return-median.rst

       This operator can be used as an accumulator and as an aggregation
       expression.

   * - :group:`$percentile`
     - .. include:: /includes/aggregation/fact-return-percentile.rst

       This operator can be used as an accumulator and as an aggregation
       expression.

.. _7.0-time-series:

Time Series
-----------

MongoDB 7.0 removes most of the :ref:`time series limitations
<timeseries-limitations-deletes>` from these operations that are based
on the :dbcommand:`delete` command:

.. include:: /includes/time-series/fact-delete-operations-list.rst

.. _7.0-sharding:

Sharding
--------

mergeAllChunksOnShard Command
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0, the :dbcommand:`mergeAllChunksOnShard` command
finds and merges all :ref:`mergeable chunks <mergeability>` that a shard 
owns for a given collection.

The {+auto-merge-upper+}
~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0, :ref:`the {+auto-merge-upper+} 
<automerger-concept>` can automatically merge chunks that meet the 
:ref:`mergeability requirements <mergeability-concept>`. The 
{+auto-merge-upper+} is enabled by default. 

For details on which settings to customize for your deployment, see
:ref:`AutoMerger Policy <automerge-policy-settings>`.

enableAutoMerger Parameter for configureCollectionBalancing
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0, the :dbcommand:`configureCollectionBalancing`
command accepts the ``enableAutoMerger`` parameter. Use 
``enableAutoMerger`` to set whether or not the 
:ref:`{+auto-merge-upper+} <automerger-concept>` takes this collection 
into account.

.. _7.0-upgrade:

Upgrade Procedures
------------------

.. important:: Feature Compatibility Version

   To upgrade to MongoDB 7.0 from a 6.0 deployment, the 5.0 deployment
   must have ``featureCompatibilityVersion`` set to ``6.0``. To check
   the version:

   .. code-block:: javascript

      db.adminCommand( { getParameter: 1, featureCompatibilityVersion: 1 } )

To upgrade to MongoDB 7.0, refer to the upgrade instructions specific to
your MongoDB deployment:

- :ref:`<7.0-upgrade-standalone>`

- :ref:`<7.0-upgrade-replica-set>`

- :ref:`<7.0-upgrade-sharded-cluster>`

If you need guidance on upgrading to 7.0, MongoDB professional services
offer major version upgrade support to help ensure a smooth transition
without interruption to your MongoDB application. To learn more, see
:products:`MongoDB Consulting </consulting?tck=docs_server>`.

.. _7.0-downgrade-considerations:

Downgrade Considerations
------------------------

Downgrade Policy Changes
~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0: 

- Binary downgrades are no longer supported for MongoDB Community Edition. 

- You cannot downgrade your deployment's {+fcv+} to or from a
  :ref:`rapid release <rapid-releases>` version of MongoDB.

- The :dbcommand:`setFeatureCompatibilityVersion` command requires an
  additional parameter, ``confirm``, which must be set to ``true`` to
  upgrade or downgrade {+fcv+}.

- If you upgrade or downgrade your deployment's {+fcv+}, you cannot
  downgrade your Enterprise deployment's binary version without assistance from
  support.

.. |version| replace:: 7.0

.. _7.0-downgrade-incompatible:

Backward-Incompatible Features
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The following 7.0 features are not compatible with earlier versions of
MongoDB. To downgrade from MongoDB 7.0 to an earlier version, you must
remove data that uses any of the following features:

- Config shards

- Secondary :ref:`TTL indexes <index-feature-ttl>` with :ref:`partial
  filters <index-type-partial>` on :ref:`time-series collections
  <manual-timeseries-collection>`

- Time series collections with custom bucketing parameters

- Collections with ``encryptedFields`` with :ref:`range indexes
  <sharding-ranged>`

- :ref:`Capped collections <manual-capped-collection>` with a size that
  is not a multiple of 256 bytes

- Config servers that have collections with
  ``changeStreamPreAndPostImages`` enabled

.. _7.0-download:

Download
--------

To download MongoDB 7.0, go to the `MongoDB Download Center
<https://www.mongodb.com/try/download?tck=docs_server>`__.

Report an Issue
---------------

.. include:: /includes/report-an-issue.rst

.. toctree::
   :titlesonly:
   :hidden:
   
   /release-notes/7.0-compatibility
   /release-notes/7.0-downgrade
   /release-notes/7.0-upgrade
