.. _release-notes-7.0:

=================================================
Release Notes for MongoDB 7.0 (Release Candidate)
=================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: twocols

.. include:: includes/rc-available.rst

This page describes changes and new features introduced in MongoDB 7.0.

MongoDB 7.0 is a |lts| Release, which means that it is supported for
both MongoDB Atlas and on-premises deployments. MongoDB 7.0 includes
changes introduced in MongoDB Rapid Releases 6.1, 6.2, and 6.3. To see
changes introduced in these rapid releases, see
:ref:`7.0-rapid-release-changes`. 

To learn more about the differences between |lts| and Rapid releases,
see :ref:`release-version-numbers`.

Atlas Search Index Management
-----------------------------

Starting in MongoDB 7.0, you can manage :atlas:`{+fts+} indexes
</atlas-search/atlas-search-overview/#fts-indexes>` with ``mongosh``
methods and database commands. {+fts+} index commands are only available
for deployments hosted on :atlas:`MongoDB Atlas </>`, and require an
Atlas cluster tier of at least M10.

To manage {+fts+} indexes, use the following commands:

.. |fts-index| replace:: {+fts+} index
.. |fts-indexes| replace:: {+fts+} indexes

mongosh Methods
~~~~~~~~~~~~~~~

.. include:: /includes/atlas-search-commands/mongosh-method-table.rst

Database Commands
~~~~~~~~~~~~~~~~~

.. include:: /includes/atlas-search-commands/atlas-search-command-table.rst

Aggregation Stages
~~~~~~~~~~~~~~~~~~

.. list-table::
   :widths: 30,70
   :header-rows: 1

   * - Name

     - Description

   * - :pipeline:`$listSampledQueries`

     - Lists sampled queries for all collections or a specific 
       collection. 

   * - :pipeline:`$listSearchIndexes`

     - .. include:: /includes/atlas-search-commands/command-descriptions/getSearchIndexes-description.rst


General Changes
---------------

Cache Refresh Time Fields
~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0, :ref:`log messages for slow queries
<log-message-slow-ops>` includes a new :ref:`cache refresh time field
<log-messages-cache-refresh-times>`.

``currentOp`` Metrics
~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0, the :dbcommand:`currentOp` command and the
:method:`db.currentOp()` method include these new fields:

- :data:`currentOp.admissionPriority`
- :data:`currentOp.collUuid`
- :data:`currentOp.startTime`
- :data:`currentOp.samplesPerSecond`
- :data:`currentOp.sampledReadsCount`
- :data:`currentOp.sampledWritesCount`
- :data:`currentOp.sampledReadsBytes`
- :data:`currentOp.sampledWritesBytes`

``$currentOp`` (aggregation) Metrics
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0, the :ref:`currentOp <current-op-agg>` 
aggregation stage includes these new fields: 

- :data:`$currentOp.collUuid`
- :data:`$currentOp.startTime`
- :data:`$currentOp.samplesPerSecond`
- :data:`$currentOp.sampledReadsCount`
- :data:`$currentOp.sampledWritesCount`
- :data:`$currentOp.sampledReadsBytes`
- :data:`$currentOp.sampledWritesBytes`

Compound Wildcard Indexes
~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0, you can create :ref:`compound wildcard indexes
<wildcard-index-compound>`. A compound wildcard index has one wildcard
term and one or more additional index terms.

Use compound wildcard indexes to support queries on known patterns and
to limit the total number of indexes in a collection. 

Large Change Stream Events
~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0, if you have :ref:`change stream
<changeStreams>` events larger than 16 MB, you can use the new
:pipeline:`$changeStreamSplitLargeEvent` stage to split the events into
smaller fragments.

The following new metrics report information about large change stream
events:

- :serverstatus:`metrics.changeStreams`
- :serverstatus:`metrics.changeStreams.largeEventsFailed`
- :serverstatus:`metrics.changeStreams.largeEventsSplit`

{+sbe-title+}
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0, the :ref:`{+sbe+} <sbe-landing>` improves
performance for a wider range of find and aggregation queries.

:ref:`Slow query log messages <log-message-json-examples-slow-op>` now
include a ``queryFramework`` field that indicates which query engine
completed the query:

- ``queryFramework: "classic"`` indicates that the classic engine
  completed the query.

- ``queryFramework: "sbe"`` indicates that the {+sbe+} completed the
  query.

User Roles System Variable
~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0, you can use the new :variable:`USER_ROLES`
system variable to return the :ref:`roles <roles>` of the current user.

.. include:: /includes/user-roles-system-variable-examples-list.rst

New Sharding Statistics for Chunk Migrations
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/chunk-migrations-version-list.rst

MongoDB includes the following new sharding statistics for chunk
migrations:

- :serverstatus:`shardingStatistics.countDonorMoveChunkCommitted`
- :serverstatus:`shardingStatistics.countDonorMoveChunkAborted`
- :serverstatus:`shardingStatistics.totalDonorMoveChunkTimeMillis`
- :serverstatus:`shardingStatistics.countBytesClonedOnRecipient`
- :serverstatus:`shardingStatistics.countDocsClonedOnCatchUpOnRecipient`
- :serverstatus:`shardingStatistics.countBytesClonedOnCatchUpOnRecipient`

New Slow Query Log Message
~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/fact-totalOplogSlotDurationMicros.rst 

To learn more, see :ref:`log-message-slow-ops`.

New Parameters
~~~~~~~~~~~~~~

analyzeShardKey-related Parameters
``````````````````````````````````

MongoDB 7.0 adds the following parameters related to the 
``analyzeShardKey`` command:

- :parameter:`analyzeShardKeyCharacteristicsDefaultSampleSize`
- :parameter:`analyzeShardKeyNumMostCommonValues`
- :parameter:`analyzeShardKeyNumRanges`
- :parameter:`analyzeShardKeyMonotonicityCorrelationCoefficientThreshold`

autoMergerIntervalSecs Parameter
````````````````````````````````

MongoDB 7.0 adds the :parameter:`autoMergerIntervalSecs` parameter 
which, when {+auto-merge-upper+} is enabled, specifies the amount of 
time between {+auto-merge-action+} rounds, in seconds. 
``autoMergerIntervalSecs`` can only be set on config servers of sharded
clusters.

autoMergerThrottlingMS Parameter
````````````````````````````````

MongoDB 7.0 adds the :parameter:`autoMergerThrottlingMS` which, when 
{+auto-merge-upper+} is enabled, specifies the minimum amount time 
between merges initiated by the {+auto-merge-upper+} on the same 
collection, in milliseconds. ``autoMergerThrottlingMS`` can only be set
on config servers of sharded clusters.

balancerMigrationsThrottlingMs Parameter
````````````````````````````````````````

MongoDB 7.0 adds the :parameter:`balancerMigrationsThrottlingMs`
parameter which allows you to throttle the balancing rate.

gEnableDetailedConnectionHealthMetricLogLines Parameter
```````````````````````````````````````````````````````

MongoDB 7.0 adds the :parameter:`gEnableDetailedConnectionHealthMetricLogLines`
parameter which lets you specify whether or not a set of :ref:`log messages 
<log-messages-ref>` related to cluster connection health metrics appears in the 
log.

``oidcIdentityProviders`` Parameter
```````````````````````````````````

MongoDB 7.0  adds the :parameter:`oidcIdentityProviders` parameter which allows 
you to specify identity provider (IDP) configurations when using 
:ref:`OpenID Connect <authentication-oidc>` authentication. 

configureQueryAnalysis-related Parameters
`````````````````````````````````````````

MongoDB 7.0 adds the following parameters related to the
``configureQueryAnalysis`` command:

- :parameter:`queryAnalysisSamplerConfigurationRefreshSecs`
- :parameter:`queryAnalysisWriterIntervalSecs`
- :parameter:`queryAnalysisWriterMaxMemoryUsageBytes`
- :parameter:`queryAnalysisWriterMaxBatchSize`
- :parameter:`queryAnalysisSampleExpirationSecs`

Security
--------

{+qe+} General Availability
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0, :ref:`Queryable Encryption with equality
queries <qe-manual-feature-qe>` is generally available (GA). 
Improvements in the GA make it incompatible with the
{+qe-preview+}, which should not be used now that the feature is GA. 
For details, see :ref:`7.0-compatibility`.

KMIP 1.0 and 1.1 Support
~~~~~~~~~~~~~~~~~~~~~~~~

MongoDB 7.0 (and 6.0.6) adds the :setting:`useLegacyProtocol
<security.kmip.useLegacyProtocol>` setting. This setting allows MongoDB
servers to connect to KMIP servers that use KMIP protocol version 1.0 or
1.1.

OpenSSL and FIPS Support
````````````````````````

.. include:: /includes/ssl-and-fips-support.rst

For details, see :ref:`transport-encryption`.

OpenID Connect
``````````````
Starting in 7.0, MongoDB Enterprise provides support for 
:ref:`OpenID Connect <authentication-oidc>` authentication. OpenID Connect is an 
authentication layer built on top of OAuth2. You can use OpenID Connect to 
configure single sign-on between your MongoDB database and a third-party identity 
provider.

Aggregation
-----------

New operators:

.. list-table::
   :header-rows: 1

   * - Name
     - Description

   * - :group:`$median` 
     - .. include:: /includes/aggregation/fact-return-median.rst

       This operator can be used as an accumulator and as an aggregation
       expression.

   * - :group:`$percentile`
     - .. include:: /includes/aggregation/fact-return-percentile.rst

       This operator can be used as an accumulator and as an aggregation
       expression.

.. _7.0-time-series:

Time Series
-----------

MongoDB 7.0 removes most of the :ref:`time series limitations
<timeseries-limitations-deletes>` from these operations that are based
on the :dbcommand:`delete` command:

.. include:: /includes/time-series/fact-delete-operations-list.rst

.. _7.0-sharding:

Sharding
--------

mergeAllChunksOnShard Command
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0, the :dbcommand:`mergeAllChunksOnShard` command
finds and merges all :ref:`mergeable chunks <mergeability>` that a shard 
owns for a given collection.

The {+auto-merge-upper+}
~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0, :ref:`the {+auto-merge-upper+} 
<automerger-concept>` can automatically merge chunks that meet the 
:ref:`mergeability requirements <mergeability-concept>`. The 
{+auto-merge-upper+} is enabled by default. 

Starting in MongoDB 7.0, you can use the following methods to control
the {+auto-merge-upper+} behavior:

- :method:`sh.startAutoMerger()`
- :method:`sh.stopAutoMerger()`
- :method:`sh.enableAutoMerger()`
- :method:`sh.disableAutoMerger()`

enableAutoMerger Parameter for configureCollectionBalancing
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0, the :dbcommand:`configureCollectionBalancing`
command accepts the ``enableAutoMerger`` parameter. Use 
``enableAutoMerger`` to set whether or not the 
:ref:`{+auto-merge-upper+} <automerger-concept>` takes this collection 
into account.

rangeDeleterHighPriority Parameter for Deprioritizing Range deletions
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0, you can prioritize or deprioritize cleanup of
:term:`orphaned documents <orphaned document>` over user operations
using the :parameter:`rangeDeleterHighPriority` parameter. 

operationsBlockedByRefresh Metrics Removed
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

MongoDB 7.0 removes the ``operationsBlockedByRefresh`` document that
contains statistics about operations blocked by catalog cache refresh
activity because the ``operationsBlockedByRefresh`` counters increased
on ``mongos`` for every operation that used collection routing
information even if the operation wasn't blocked by a catalog refresh
activity. 

analyzeShardKey Command and db.collection.analyzeShardKey() Method
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

MongoDB 7.0 adds the :dbcommand:`analyzeShardKey` command and the 
:method:`db.collection.analyzeShardKey()` method, which let you
calculate metrics for evaluating a shard key.

configureQueryAnalyzer Command and db.collection.configureQueryAnalyzer() Method 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

MongoDB 7.0 adds the :dbcommand:`configureQueryAnalyzer` command, which
allows you to configure query sampling for a collection. MongoDB 7.0
also adds the :method:`db.collection.configureQueryAnalyzer()`, which
wraps the ``configureQueryAnalyzer`` command. Sampled queries provide 
information to ``analyzeShardKey`` to calculate metrics about read and 
write distribution of a shard key.

``serverStatus`` Output Change
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

:dbcommand:`serverStatus` includes the following new fields in its
output:

Plan Cache Metrics
  - :serverstatus:`planCache`

queryAnalyzer Metrics
  - :serverstatus:`queryAnalyzers.activeCollections` 
  - :serverstatus:`queryAnalyzers.totalCollections`
  - :serverstatus:`queryAnalyzers.totalSampledReadsCount`
  - :serverstatus:`queryAnalyzers.totalSampledWritesCount`
  - :serverstatus:`queryAnalyzers.totalSampledReadsBytes`
  - :serverstatus:`queryAnalyzers.totalSampledWritesBytes`

.. _7.0-rapid-release-changes:

Changes Introduced in 6.X-Series Rapid Releases
-----------------------------------------------

MongoDB 7.0 includes changes and features from the following Rapid
Release versions:

- :ref:`MongoDB 6.1 Release Notes <release-notes-6.1>`

- :ref:`MongoDB 6.2 Release Notes <release-notes-6.2>`

- :ref:`MongoDB 6.3 Release Notes <release-notes-6.3>`

.. _7.0-rel-notes-platforms:

Platform Support
----------------

Removed Platforms
~~~~~~~~~~~~~~~~~

MongoDB 7.0 removes support for **RHEL 7 / CentOS 7 / Oracle 7** on the
:ref:`PPC64LE <prod-notes-supported-platforms-PPC64LE>` and :ref:`s390x 
<prod-notes-supported-platforms-s390x>` architectures.
  

.. _7.0-upgrade:

Upgrade Procedures
------------------

.. important:: Feature Compatibility Version

   To upgrade to MongoDB 7.0 from a 6.0 deployment, the 5.0 deployment
   must have ``featureCompatibilityVersion`` set to ``6.0``. To check
   the version:

   .. code-block:: javascript

      db.adminCommand( { getParameter: 1, featureCompatibilityVersion: 1 } )

To upgrade to MongoDB 7.0, refer to the upgrade instructions specific to
your MongoDB deployment:

- :ref:`<7.0-upgrade-standalone>`

- :ref:`<7.0-upgrade-replica-set>`

- :ref:`<7.0-upgrade-sharded-cluster>`

If you need guidance on upgrading to 7.0, MongoDB professional services
offer major version upgrade support to help ensure a smooth transition
without interruption to your MongoDB application. To learn more, see
:products:`MongoDB Consulting </consulting?tck=docs_server>`.

.. _7.0-downgrade-considerations:

Downgrade Considerations
------------------------

Only Single-Version Downgrades are Supported 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 

.. include:: /includes/7.0-upgrade-replacements.rst

.. include:: includes/downgrade/single-version-support.rst

Downgrade Policy Changes
~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 7.0: 

- Binary downgrades are no longer supported for MongoDB Community Edition. 

- You cannot downgrade your deployment's {+fcv+} to or from a
  :ref:`rapid release <rapid-releases>` version of MongoDB.

- The :dbcommand:`setFeatureCompatibilityVersion` command requires an
  additional parameter, ``confirm``, which must be set to ``true`` to
  upgrade or downgrade {+fcv+}.

- If you upgrade or downgrade your deployment's {+fcv+}, you cannot
  downgrade your Enterprise deployment's binary version without assistance from
  support.

.. |version| replace:: 7.0

Backward-Incompatible Features
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

MongoDB 7.0 includes features that are not compatible with earlier releases.
Downgrading from 7.0 to an earlier release requires that you remove data 
that uses these features.

For more information, see :ref:`7.0-downgrade-incompatible`.

.. _7.0-download:

Download
--------

To download MongoDB 7.0, go to the `MongoDB Download Center
<https://www.mongodb.com/try/download?tck=docs_server>`__.

Report an Issue
---------------

.. include:: /includes/report-an-issue.rst

.. toctree::
   :titlesonly:
   :hidden:
   
   /release-notes/7.0-compatibility
   /release-notes/7.0-downgrade
   /release-notes/7.0-upgrade
